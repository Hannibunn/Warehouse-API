<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Lego Sets Grid</title>
<style>
body { font-family: sans-serif; margin: 0; padding: 0; background: #f2f2f2; }
#q { width: 100%; padding: 10px; font-size: 16px; margin-bottom: 10px; box-sizing: border-box; }
#grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px,1fr)); gap: 10px; padding: 10px; }
.card { background: #fff; border-radius: 10px; overflow: hidden; box-shadow: 0 0 5px rgba(0,0,0,0.2); display: flex; flex-direction: column; transition: transform 0.2s; }
.card.expanded { transform: scale(1.05); }
.media img { width: 100%; height: auto; display: block; }
.meta { padding: 10px; }
.meta .kv { font-size: 14px; color: #555; }
.extra { padding: 10px; background: #f9f9f9; }
.tags { display: flex; flex-wrap: wrap; gap: 5px; margin-top: 5px; }
.tag { background: #ddd; padding: 3px 6px; border-radius: 3px; font-size: 12px; }
.foot { padding: 10px; text-align: center; }
button.more { cursor: pointer; padding: 5px 10px; border: none; background: #007bff; color: white; border-radius: 5px; }
button.more:hover { background: #0056b3; }
.skeleton { background: #eee; }
</style>
</head>
<body>

<input type="text" id="q" placeholder="Search...">
<div id="grid"></div>

<script>
const API_SETS = 'https://Setsapi.pleeging.com/api/Warehouseapi?AdminKey=TheLionwants3datelsafter20request';

const grid = document.getElementById('grid');
const qInput = document.getElementById('q');
let allSets = [];

function el(tag, cls, html){
  const n = document.createElement(tag);
  if(cls) n.className = cls;
  if(html != null) n.innerHTML = html;
  return n;
}

function makeImage(url, alt){
  const wrap = el('div','media');
  const img = new Image();
  img.alt = alt || '';
  img.loading = 'lazy';
  img.classList.add('skeleton');
  img.src = url || '';
  img.addEventListener('load',()=> img.classList.remove('skeleton'));
  img.addEventListener('error', ()=>{
    img.classList.remove('skeleton');
    img.src = 'data:image/svg+xml;charset=utf-8,' + encodeURIComponent(
      '<svg xmlns="http://www.w3.org/2000/svg" width="640" height="400"><rect width="100%" height="100%" fill="#ddd"/><text x="50%" y="50%" text-anchor="middle" font-family="sans-serif" font-size="18" fill="#666">kein Bild</text></svg>'
    );
  });
  wrap.appendChild(img);
  return wrap;
}

function makeCard(s){
  const card = el('article','card');
  card.appendChild(makeImage(s.image.imageURL, s.name));

  const meta = el('div','meta');
  meta.appendChild(el('div','name', s.name || 'Unbenannt'));
  meta.appendChild(el('div','kv', `Theme: ${s.theme || '-'}`));
  meta.appendChild(el('div','kv', `Year: ${s.year ?? '-'}`));
  meta.appendChild(el('div','kv', `SetID: ${s.setID ?? '-'}`));
  meta.appendChild(el('div','kv', `Pieces: ${s.pieces ?? '-'}`));
  card.appendChild(meta);

  const extra = el('div','extra');
  const inner = el('div','extra-inner');
  inner.appendChild(el('div','dim','Tags'));
  const tagsWrap = el('div','tags');
  (s.tags || []).forEach(t => tagsWrap.appendChild(el('span','tag', t)));
  if((s.tags || []).length === 0) tagsWrap.appendChild(el('span','dim','keine Tags'));
  inner.appendChild(tagsWrap);
  extra.appendChild(inner);
  card.appendChild(extra);

  const foot = el('div','foot');
  const btn = el('button','more','See more');
  btn.addEventListener('click',()=>{
    const open = card.classList.toggle('expanded');
    btn.textContent = open ? 'See less' : 'See more';
  });
  foot.appendChild(btn);
  card.appendChild(foot);

  return card;
}

function renderList(list){
  grid.innerHTML = '';
  list.forEach(s => grid.appendChild(makeCard(s)));
}

function applyFilter(){
  const q = qInput.value.trim().toLowerCase();
  if(!q){ renderList(allSets); return; }
  const filtered = allSets.filter(s=>{
    const hay = [s.name,s.theme,String(s.year),String(s.setID),...(s.tags||[])].join(' ').toLowerCase();
    return hay.includes(q);
  });
  renderList(filtered);
}

let t;
qInput.addEventListener('input',()=>{
  clearTimeout(t);
  t = setTimeout(applyFilter,150);
});

async function init(){
  try{
    const r = await fetch(API_SETS, { headers: {'Accept':'application/json'} });
    if(!r.ok) throw new Error('API Request fehlgeschlagen');
    const data = await r.json();

    allSets = (data || []).map(x=>({
      id: x.id,
      setID: x.setID,
      name: x.name,
      theme: x.theme,
      year: x.year,
      pieces: x.pieces,
      tags: [], 
      image: x.image 
    }));

    renderList(allSets);
  }catch(err){
    console.error(err);
    alert('API konnte nicht geladen werden, zeige Demo-Daten');
    allSets = [
      {id:7,setID:3074,name:'Darth Mauls Sith Infiltrator',theme:'Star Wars',year:1974,pieces:18,image:{imageURL:'Picture/set1.png'},tags:['Aircraft']},
      {id:8,setID:4090,name:'Podracer',theme:'Star Wars',year:1974,pieces:18,image:{imageURL:'Picture/set2.png'},tags:['Aircraft']},
      {id:9,setID:5011,name:'NINJAGO Mech',theme:'Ninjago',year:2020,pieces:612,image:{imageURL:'Picture/ninjago.png'},tags:['Robot']}
    ];
    renderList(allSets);
  }
}

init();
</script>
</body>
</html>
