<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Box</title>
<style>
  :root{
    --bg:#f0e9e1; --panel:#fff; --ink:#1a1a1a; --muted:#888;
    --line:rgba(0,0,0,.12); --radius:14px; --shadow:0 8px 22px rgba(0,0,0,.12);
    --accent:#b48b68; --accent-ink:#fff;
  }
  html,body{margin:0;padding:0;color:var(--ink);font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:var(--bg)}
  .container{max-width:1200px;margin:0 auto;padding:0 16px}

  /* Header */
  .header{background:var(--bg);border-bottom:1px solid var(--line);position:sticky;top:0;z-index:10}
  .header-inner{display:flex;align-items:center;gap:16px;padding:16px 0}
  .brand{display:flex;align-items:center;gap:12px;font-weight:700}
  .brand img{width:36px;height:36px}
  .nav{display:flex;gap:16px;font-weight:600}
  .nav a{text-decoration:none;color:inherit;opacity:.75}
  .nav a.active{opacity:1}
  .spacer{flex:1}
  .icons .avatar{width:28px;height:28px;border-radius:50%;box-shadow:inset 0 0 0 1px var(--line)}

  /* Titel + Suche + Add */
  .page-title{text-align:center;font-weight:900;font-size:clamp(36px,6vw,74px);margin:24px 0 12px}
  .title-tools{max-width:1200px;margin:0 auto 16px;padding:0 16px;display:grid;grid-template-columns:1fr auto 1fr;align-items:center;gap:20px}
  .search{grid-column:2;display:flex;align-items:center;gap:10px;height:50px;padding:0 16px;border-radius:28px;background:#fff;box-shadow:inset 0 0 0 1px var(--line);width:clamp(660px,70vw,960px)}
  .search input{flex:1;border:none;outline:none;height:100%;background:transparent;font-size:16px}
  .title-girl{grid-column:3;justify-self:end;width:140px;height:auto}
  .add-btn{grid-column:1;justify-self:start;background:var(--accent);color:var(--accent-ink);border:none;border-radius:28px;height:50px;padding:0 22px;font-weight:700;cursor:pointer;box-shadow:var(--shadow)}
  @media(max-width:900px){
    .title-girl{display:none}
    .title-tools{grid-template-columns:1fr}
    .search{grid-column:1;justify-self:center;width:100%}
    .add-btn{order:-1;justify-self:stretch}
  }

  /* Grid Karten */
  main{background:var(--bg);padding:8px 0 48px}
  .grid{max-width:1300px;margin:0 auto;padding:0 16px;display:grid;gap:32px;grid-template-columns:repeat(auto-fit,minmax(360px,1fr))}
  @media(min-width:1200px){ .grid{grid-template-columns:repeat(3,1fr)} }

  .card{background:var(--panel);border-radius:var(--radius);box-shadow:var(--shadow);overflow:hidden;border:1px solid var(--line);display:flex;flex-direction:column;transition:transform .25s ease,box-shadow .25s ease}
  .card:hover{transform:translateY(-2px);box-shadow:0 12px 30px rgba(0,0,0,.16)}
  .media{background:#e9eaec;display:grid;place-items:center;padding:28px}
  .media .box-icon{width:180px;height:180px;opacity:.7}
  .meta{padding:18px 20px 10px;display:grid;gap:8px}
  .name{font-weight:700}
  .kv{font-size:15px;color:#333}
  .dim{color:var(--muted);font-size:13px}
  .foot{display:flex;justify-content:flex-end;padding:14px 16px 16px}
  .more{border:1px solid var(--line);background:#f4f4f4;padding:10px 14px;border-radius:12px;cursor:pointer;font-weight:600}
  .extra{overflow:hidden;max-height:0;transition:max-height .35s ease,transform .35s ease;transform:scale(.98);border-top:1px dashed var(--line);margin:0 16px 16px;border-radius:12px;background:linear-gradient(135deg,#fcfcfc,#f1f1f1);padding:0 12px}
  .extra-inner{padding:16px 6px;display:grid;gap:10px}
  .card.expanded .extra{max-height:360px;transform:scale(1)}
</style>
</head>
<body>

<header class="header">
  <div class="container header-inner">
    <div class="brand">
      <img src="Picture/logo.png" alt="Logo">
      <div>Warehouse-Api</div>
    </div>
    <nav class="nav" aria-label="Navigation">
      <a href="versuch.html">HOME</a>
      <a href="Sets.html">SETS</a>
      <a class="active" href="box.html">BOX</a>
    </nav>
    <div class="spacer"></div>
    <div class="icons"><div class="avatar"></div></div>
  </div>
</header>

<h1 class="page-title">Box</h1>

<div class="title-tools">
  <button class="add-btn" id="btnAdd">+ Add Box</button>

  <div class="search" role="search" aria-label="Box suchen">
    <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
      <path d="M21 21l-4.35-4.35M10.5 18a7.5 7.5 0 1 1 0-15 7.5 7.5 0 0 1 0 15Z" stroke="#666" stroke-width="2" stroke-linecap="round"/>
    </svg>
    <input id="q" placeholder="Suche" />
  </div>

  <img class="title-girl" src="Picture/jungelauft.png" alt="Runner" />
</div>

<main>
  <section class="grid" id="grid"></section>
</main>

<script>
  // API-Basis: dein LoginController verwaltet Boxen
  const API_BOX_BASE = '/api/Login'; // GET /api/Login  -> GetUserBoxes (JWT)
                                    // POST /api/Login  -> CreateBox
  const grid = document.getElementById('grid');
  const qInput = document.getElementById('q');
  const btnAdd = document.getElementById('btnAdd');
  let allBoxes = [];

  btnAdd.addEventListener('click', ()=> location.href='box-new.html');

  function el(tag, cls, html){ const n = document.createElement(tag); if(cls) n.className=cls; if(html!=null) n.innerHTML=html; return n; }

  function boxIcon(){
    const svg = `
      <svg class="box-icon" viewBox="0 0 24 24" fill="none">
        <path d="M3 7l9 4 9-4M3 7l9-4 9 4M3 7v10l9 4 9-4V7" stroke="#000" stroke-width="1.6" stroke-linejoin="round"/>
      </svg>`;
    const w = el('div','media'); w.innerHTML = svg; return w;
  }

  function makeCard(b){
    const card = el('article','card');
    card.appendChild(boxIcon());

    const meta = el('div','meta');
    meta.appendChild(el('div','name', b.name || 'Unbenannt'));
    meta.appendChild(el('div','kv', 'Description: ' + (b.description || '-')));
    card.appendChild(meta);

    const extra = el('div','extra');
    const inner = el('div','extra-inner');
    inner.appendChild(el('div','dim', 'Sets in der Box'));
    const list = el('div','kv', (b.sets||[]).map(s=>`${s.name||s.Name||'Set'} (#${s.setId||s.Id||s.ID||''})`).join('<br>') || 'keine');
    inner.appendChild(list);
    extra.appendChild(inner);
    card.appendChild(extra);

    const foot = el('div','foot');
    const btn = el('button','more','See more');
    btn.addEventListener('click', ()=>{
      const open = card.classList.toggle('expanded');
      btn.textContent = open ? 'See less' : 'See more';
    });
    foot.appendChild(btn); card.appendChild(foot);
    return card;
  }

  function render(list){
    grid.innerHTML=''; list.forEach(b=>grid.appendChild(makeCard(b)));
  }

  function applyFilter(){
    const q = qInput.value.trim().toLowerCase();
    if(!q){ render(allBoxes); return; }
    const filtered = allBoxes.filter(b=>{
      const hay = [b.name,b.description,(b.sets||[]).map(s=>s.name).join(' ')].join(' ').toLowerCase();
      return hay.includes(q);
    });
    render(filtered);
  }
  let t; qInput.addEventListener('input',()=>{ clearTimeout(t); t=setTimeout(applyFilter,150); });

  init();
  async function init(){
    try{
      const token = localStorage.getItem('token') || '';
      const r = await fetch(API_BOX_BASE, { headers:{ 'Accept':'application/json', 'Authorization': 'Bearer ' + token }});
      if(!r.ok) throw new Error();
      const data = await r.json();
      // Normalisiere
      allBoxes = (data||[]).map(b=>({
        id: b.id ?? b.ID,
        name: b.name ?? b.Name,
        description: b.description ?? b.Description,
        sets: b.sets ?? b.Sets ?? []
      }));
      render(allBoxes);
    }catch{
      // Demo-Fallback
      allBoxes = [
        { id:1, name:'StarWars', description:'Beispiel-Box', sets:[{name:'X-Wing', setId:123}] },
        { id:2, name:'City', description:'Kleinkram', sets:[] },
        { id:3, name:'Technic', description:'Fahrzeuge', sets:[{name:'Kran', setId:777}] }
      ];
      render(allBoxes);
    }
  }
</script>
</body>
</html>
